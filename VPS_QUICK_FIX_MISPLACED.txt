# Quick Fix - Remove All Misplaced Code After raise HTTPException
# Copy and paste this to your VPS:

cd /opt/petrodealhub/document-processor && cp main.py main.py.fix_misplaced.$(date +%Y%m%d_%H%M%S) && RAISE_LINE=$(grep -n "raise HTTPException.*Template not found.*template_id" main.py | head -1 | cut -d: -f1) && NEXT_SECTION=$(grep -n "^        # Also update local metadata file if template_record has file_name" main.py | head -1 | cut -d: -f1) && if [ ! -z "$NEXT_SECTION" ] && [ $NEXT_SECTION -gt $((RAISE_LINE + 1)) ]; then sed -i "$((RAISE_LINE+1)),$((NEXT_SECTION-1))d" main.py && echo "✅ Removed $((NEXT_SECTION - RAISE_LINE - 1)) misplaced lines"; else echo "⚠️  Could not find next section, trying alternative fix..."; sed -i "$((RAISE_LINE+1)),$((RAISE_LINE+20))d" main.py && echo "✅ Removed 20 lines after raise"; fi && source venv/bin/activate && python3 -m py_compile main.py && echo "✅ Syntax OK" && pm2 restart python-api && sleep 3 && curl http://localhost:8000/health || echo "Check logs: pm2 logs python-api --err"
